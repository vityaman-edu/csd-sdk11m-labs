# Лабораторная работа 2. Последовательный интерфейс UART

## Цели работы

1. Изучить протокол передачи данных по интерфейсу UART.

2. Получить базовые знания об организации системы прерываний в микроконтроллерах на примере микроконтроллера STM32.

3. Изучить устройство и принципы работы контроллера интерфейса UART, получить навыки организации обмена данными по UART в режимах опроса и прерываний.

## Задание

Разработать и реализовать два варианта драйверов UART для стенда SDK-1.1M: с использованием и без использования прерываний.

Драйверы, использующие прерывания, должны обеспечивать работу в «неблокирующем» режиме (возврат из функции происходит сразу же, без ожидания окончания приема/отправки), а также буферизацию данных для исключения случайной потери данных.

В драйвере, не использующем прерывания, функция приема данных также должна быть «неблокирующей», то есть она не должна зависать до приема данных (которые могут никогда не поступить).

При использовании режима «без прерываний» прерывания от соответствующего блока UART должны быть запрещены.

Написать с использованием разработанных драйверов программу, которая выполняет определенную вариантом задачу.

Для всех вариантов должно быть реализовано два режима работы программы: с использованием и без использования прерываний.

Каждый принимаемый стендом символ должен отсылаться обратно, чтобы он был выведен в консоли (так называемое «эхо»).

Каждое новое сообщение от стенда должно выводиться с новой строки.

Если вариант предусматривает работу с командами, то на каждую команду должен выводиться ответ, определенный в задании или «ОК», если ответ не требуется.

Если введена команда, которая не поддерживается, должно быть выведено сообщение об этом.

Скорость работы интерфейса UART должна соответствовать указанной в варианте задания.

## Порядок выполнения работы

### Изучить теорию

- разделы учебного пособия

  1. 1.3. Прерывания;
  
  2. 1.4. Последовательный интерфейс UART;

- электрическую принципиальную схему стенда в части назначения сигналов отладочного интерфейса UART;

- раздел справочного руководства RM0090: «Universal synchronous asynchronous receiver transmitter (USART)», знать устройство контроллера USART, режимы его работы и способы настройки;

- раздел справочного руководства PM0214 (programming manual) [43] о контроллере прерываний: «Nested vectored interrupt controller (NVIC)», знать принципы организации системы прерываний в микроконтроллере STM32F4 и приемы ее использования;

- состав стандартного драйвера USART из библиотеки HAL и содержимое создаваемых генератором файлов usart.c/.h.

### Подготовить шаблон проекта для STM32CubeIDE, настроить тактовые частоты

### Задать настройки контроллера UART, настроить входы и выходы микроконтроллера

### Разработать драйверы UART для работы в режимах опроса и прерывания

Драйвер, работающий в режиме прерывания, должен поддерживать буферизацию данных и работу в «неблокирующем режиме».

### Разработать программу согласно варианту задания и провести ее тестирование

## Вариант 4

Разработать программу-калькулятор.

Ввод значений производится с компьютера через UART: `xx…xyxx…x=`, где `x` – десятичные цифры, `y` – знак (`+, -, *, /`).

Ввод чисел завершается либо знаком операции (для первого числа), либо знаком «равно» (для второго числа), либо после ввода пяти цифр числа.

Обратите внимание, что операнды не могут быть отрицательными, а ответ может.

Размерность результата и обоих операндов должна быть short int (16-битовое знаковое число), и должна быть предусмотрена защита от переполнения. В случае выполнения недопустимых операций (ответ или вводимые числа больше, чем размер переменных в памяти) должен загораться красный светодиод, а в последовательный канал вместо ответа выводиться слово error.

Включение/отключение прерываний должно осуществляться нажатием кнопки на стенде и сопровождаться отправкой в последовательный порт сообщения произвольного содержания, сообщающего, какой режим включен (с прерываниями или без прерываний). При смене режима необходимо сбрасывать все введенные пользователем данные и выводить приглашение начать ввод заново.

Скорость обмена данными по UART – 19200 бит/с.
