# ЛР 1. Интерфейсы ввода-вывода общего назначения (GPIO)

## Цели работы

1. Получить базовые знания о принципах устройства стенда SDK-1.1M и программировании микроконтроллеров.

2. Изучить устройство интерфейсов ввода-вывода общего назначения (GPIO) в микроконтроллерах и приемы использования данных интерфейсов.

## Задание

Разработать и реализовать драйверы управления светодиодными индикаторами и чтения состояния кнопки стенда `SDK-1.1М` (расположены на боковой панели стенда).

Обработка нажатия кнопки в программе должна включать программную защиту от дребезга.

Функции и другие компоненты драйверов должны быть универсальными, т. е. пригодными для использования в любом из вариантов задания и не должны содержать прикладной логики программы.

Функции драйверов должны быть неблокирующими, то есть не должны содержать ожиданий события (например, нажатия кнопки). Также, в драйверах не должно быть пауз с активным ожиданием (функция `HAL_Delay()` и собственные варианты с аналогичной функциональностью).

При необходимости параллельного выполнения разных процессов (например, опроса кнопки и ожидания перед переключением светодиодов) следует организовать псевдопараллельную работу процессов в стиле кооперативной многозадачности. Это возможно сделать без существенной потери точности соблюдения необходимых интервалов времени между действиями, поскольку действия выполняются очень быстро по сравнению с промежутками ожидания между ними.

Каждый процесс (который может быть выражен всего в нескольких строках кода) должен использовать не активное ожидание (`HAL_Delay()`), а считывать текущее значение миллисекундного счетчика (`HAL_GetTick()`), проверяя, прошло ли необходимое количество времени для выполнения следующего действия. После проверки и (при необходимости) выполнения действия управление должно передаваться следующему процессу, чтобы он тоже мог провести такую проверку.

Контакты подключения кнопки и светодиодов должны быть настроены в режиме `GPIO`. Использование прерываний и дополнительных таймеров (кроме `SysTick`) не допускается.

Написать программу с использованием разработанных драйверов в соответствии с вариантом задания.

## Порядок выполнения работы

### Изучить теорию

* устройство и инструкцию по эксплуатации стенда SDK-1.1M;

* основные характеристики микроконтроллера STM32 по листу данных (datasheet); документация выложена на сайте производителя [34] (например, см. документацию микроконтроллера STM32F427VIT6 [41], обозначение документа – DS9405 [7]);

* разделы учебного пособия:

  1. 1.1 Сигналы сброса и синхронизации;

  2. 1.2 Интерфейс ввода-вывода общего назначения (GPIO);

* электрическую принципиальную схему стенда в части управления светодиодами и кнопкой, используемыми в данной работе;

* раздел «General purpose I/O (GPIO)» из справочного руководства (reference manual) по микроконтроллерам линейки STM32F4 (обозначение документа – RM0090 [4]), знать устройство портов ввода-вывода, режимы их работы и способы настройки.

### Создать и настроить пустой проект программы для SDK-1.1M

### Настроить тактовые частоты

### Настроить сигналы GPIO, необходимые для выполнения задания

### Изучить код

* состав стандартного драйвера GPIO из библиотеки HAL (файлы stm32f4xx_hal_gpio.c/.h в проекте), знать основные определения и функции, принцип работы драйвера. Справочная информация находится в комментариях в файле драйвера в документации (обозначение документа – UM1725 Description of STM32F4 HAL and low-layer drivers [42]) с сайта производителя;

* содержимое инициализационного кода в созданных генератором файлах gpio.c/.h.

### Разработать драйверы управления светодиодами и чтения состояния кнопки.

### Разработать программу согласно варианту задания и провести ее тестирование.

### Модифицировать программу

Отключить в графическом конфигураторе настройку портов GPIO. Разработать собственные функции для инициализации и использования портов GPIO (можно с использованием объявленных в стандартной библиотеке структур и констант). Заменить в программе использование библиотечных функций работы с GPIO на вызов собственных реализаций.

## Вариант 4

Реализовать двоичный двухразрядный счётчик на светодиодах с возможностью вычитания (использовать зеленый светодиод и один из двух цветов двухцветного).

Быстрое нажатие кнопки должно прибавлять единицу к отображаемому на светодиодах двоичному числу.

По переполнению счётчика должна отображаться простая анимация: мигание обоими светодиодами, затем количество миганий зелёным светодиодом, равное количеству переполнений с момента перезагрузки микроконтроллера.

Долгое нажатие кнопки должно вычитать единицу из отображаемого на светодиодах двоичного числа.

Если происходит вычитание из нуля, счетчик принимает значение 3, количество переполнений (если оно больше нуля) уменьшается на единицу и отображается анимация, аналогичная анимации при переполнении.
